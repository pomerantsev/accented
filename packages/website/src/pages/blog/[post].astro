---
import { getCollection, getEntry, render } from 'astro:content';
import { formatPostDate, getPostDate } from '~/blog-helpers';
import MainLayout from '~/layouts/MainLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({ params: { post: post.id } }));
}

const { post: postId } = Astro.params;

const currentPost = await getEntry('blog', postId);
if (!currentPost) {
  throw new Error(`Post with ID "${postId}" not found.`);
}

const { Content } = await render(currentPost);
---
<style>
  nav {
    margin-block-end: var(--space-l);
  }

  nav a {
    text-decoration-line: none;
    font-weight: 600;
  }

  @media (hover: hover) {
    nav a:hover {
      color: var(--color-primary);
    }
  }

  .subtitle {
    margin-block: var(--space-xl);
  }

  .metadata {
    margin-block-start: var(--space-xl);
  }
</style>

<MainLayout title={`${currentPost.data.title} | Blog`} description={currentPost.data.description}>
  <nav aria-label="Breadcrumbs">
    <a href="/blog">‚Üê All posts</a>
  </nav>
  <article class="flow">
    <h1>{currentPost.data.title}</h1>
    <p class="metadata">
      <time datetime={getPostDate(currentPost)}>{formatPostDate(currentPost)}</time>, by {
        currentPost.data.author
      }
    </p>
    <p class="subtitle">
      {currentPost.data.description}
    </p>
    <Content />
  </article>
</MainLayout>
